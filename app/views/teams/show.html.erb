<div class="page-header">
	<h1><%= @team.show_team %></h1>
</div>

<h4>High Score: <%= highScore(@team) %></h4>
<h4>Average Score: <%= avgScore(@team) %></h4>
<h4>Win Percentage: <%= winPerc(@team) %>%</h4>
<h4>Average Contribution: <%= avgCont(@team) %></h4>


<br>
<br>
<div class="row text-right">
  <form class="navbar-form" role="search">
    <div class="form-group">
      <input type="text" class="form-control" placeholder="Team Number or Name" name="search">
    </div>
    <button type="submit" class="btn btn-info">Search Matches</button>
  </form>
</div>
<h2>Matches for <%= @team.name %></h2><br>

<% @team.events.each do |e| %>

  <h4><%= link_to e.name, e %></h4>
  <table class='table table-striped table-hover'>
    <thead>
      <th>Match #</th>
      <th><%= red("Red 1") %></th>
      <th><%= red("Red 2") %></th>
      <th><%= blue("Blue 1") %></th>
      <th><%= blue("Blue 2") %></th>
      <th><%= red("Red") %></th>
      <th><%= blue("Blue") %></th>
    </thead>

    <% matches = [] %>

    <% if params[:search] %>
      <% teams = Team.all.where('lower(name) LIKE ? OR number LIKE ?', "%#{params[:search]}%".downcase, "%#{params[:search]}%") %>
      <% ematches = getEventMatches(@team, e) %>
      <% ematches.each do |m| %>
        <% matches << m if !matches.include?(m) && 
        (teams.include?(m.blue1) || teams.include?(m.blue2) || teams.include?(m.red1) || teams.include?(m.red2)) %>
      <% end %>
    <% else %>
      <% matches = getEventMatches(@team, e) %>
    <% end %>

    <tbody>
      <%= render matches.sort_by {|m| m.number[0]=~ /\A\d+\z/ ? ['A', Integer(m.number)] : [m.number[0], Integer(m.number[1..-1])] } %>
    </tbody>
  </table>
  <br>

<% end %>
<br>
<br>
<div class="row text-right">
	<%= link_to fa_icon('pencil', text:'Edit Team'), edit_team_path(@team), class:'btn btn-default' %> 
	<%= link_to fa_icon('trash-o', text:'Destroy Team'), @team, method: :delete, data: { confirm: 'Are you sure?' }, class:'btn btn-danger' %>
</div>